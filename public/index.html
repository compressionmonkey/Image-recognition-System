<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Tshong AI">
    <meta name="description" content="Receipt scanning and financial tracking app">
    
    <!-- Add cache control headers -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Receipt Recognition</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script src="/index.js" defer></script>

    <link rel="icon" href="data:,">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    
    <!-- Add update check script -->
    <script>
    // Check if this is a reload after update
    if (sessionStorage.getItem('app_updating') === 'true') {
        // Clear the flag
        sessionStorage.removeItem('app_updating');
        
        // Show update success message when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const toast = document.createElement('div');
            toast.className = 'update-toast';
            toast.textContent = 'App updated successfully!';
            document.body.appendChild(toast);
            
            // Show animation
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        });
    }
    </script>
    
    <style>
    .update-toast {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(-60px);
        background: #4CAF50;
        color: white;
        padding: 12px 24px;
        border-radius: 50px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 10000;
        transition: transform 0.3s ease;
        font-family: 'Open Sans', sans-serif;
        font-weight: 600;
    }
    
    .update-toast.show {
        transform: translateX(-50%) translateY(0);
    }
    </style>
</head>
<body>
    <div id="loginOverlay" class="login-container">
        <div class="login-card">
            <div class="logo-circle">
                LOGO
            </div>
            <h2>Welcome to Tshong AI</h2>
            <p class="subtitle">Simplify your financial tracking with our easy-to-use receipt scanning app. Capture, organize, and manage your expenses effortlessly.</p>
            
            <div class="features">
                <div class="feature-item">
                    <span class="icon">üì∏</span>
                    <span>Snap photos of your receipts</span>
                </div>
                <div class="feature-item">
                    <span class="icon">üìÑ</span>
                    <span>Automatically extract receipt numbers</span>
                </div>
                <div class="feature-item">
                    <span class="icon">üìä</span>
                    <span>Track and manage your expenses</span>
                </div>
            </div>

            <input type="text" id="customerID" class="login-input" placeholder="Enter Customer ID">
            <button id="login-button" onclick="validateLogin()" class="login-button">
                <span id="loginSpinner" class="spinner" style="display: none;"></span>
                Login
            </button>
            <p id="loginMessage" class="error-message"></p>
            
            <p class="terms">By continuing, you agree to our <a href="https://www.google.com">Terms of Service</a> and <a href="#">Privacy Policy</a>.</p>
        </div>
    </div>

    <div id="mainContent" style="display: none;">
        <div id="userNav">
            <div class="nav-left">
                <button id="fileHistoryBtn" class="nav-button primary" onclick="showRecentFiles()">
                    <span class="icon">üìÅ</span> File History
                </button>
            </div>
            <div class="nav-right">
                <button id="dashboardButton" class="nav-button secondary" onclick="routeUser()">
                    <span class="icon">üìä</span> View Dashboard
                </button>
            </div>
        </div>
        <div class="action-buttons">
            <button id="addPhotoBtn" class="action-button photo-button">
                <span class="icon">üì∏</span> Add ReceiptPhoto
            </button>
            <button id="addCashBtn" class="action-button cash-button">
                <span class="icon">üí∞</span> Add Cash Receipt
            </button>
        </div>
    </div>


    <!-- Add this before </body> -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <!-- <div class="question-icon">‚ùì</div>
            <h2>Is this the correct details?</h2> -->
            <form id="confirmationForm">
                <div class="form-group">
                    <label>Amount (Nu.)</label>
                    <input type="number" 
                           id="confirmAmount" 
                           min="0" 
                           step="0.01" 
                           placeholder="Nu. 0.00"
                           required>
                </div>
                <div class="form-group">
                    <label>Reference Number</label>
                    <input type="text" 
                           id="confirmReference" 
                           placeholder="Enter reference number"
                           required>
                </div>
                <div class="form-group">
                    <label>Particulars</label>
                    <input type="text" 
                           id="confirmParticulars" 
                           placeholder="Enter Particulars"
                           required>
                </div>
                <div class="form-group">
                    <label>Date of Receipt</label>
                    <input type="date" 
                           id="confirmDate" 
                           required>
                    <div id="dateValidationMessage" class="date-validation-message" style="display: none;">
                        Receipt Date is not today. Are you sure you want to add this?
                    </div>
                </div>
                <div class="button-group">
                    <button type="button" class="primary-button" onclick="handleConfirmDetails()">Confirm Details</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add this for photo options modal -->
    <div id="photoOptionsModal" class="photo-options-modal" style="display: none;">
        <div class="modal-content">
            <button onclick="handlePhotoOption('camera')" class="photo-option-btn">
                <span class="icon">üì∏</span>
                Take Photo
            </button>
            <button onclick="handlePhotoOption('gallery')" class="photo-option-btn">
                <span class="icon">üñºÔ∏è</span>
                Choose from Gallery
            </button>
            <button onclick="closePhotoOptions()" class="cancel-btn">Cancel</button>
        </div>
    </div>

    <!-- Add this before </body> alongside the success modal -->
    <div id="failureModal" class="failure-modal" style="display: none;">
        <div class="failure-content">
            <!-- Content will be dynamically updated -->
        </div>
    </div>

    <!-- Manual Receipt Entry Modal -->
    <div id="manualEntryModal" class="photo-options-modal" style="display: none;">
        <div class="modal-content">
            <h3>Add Cash Receipt</h3>
            <form id="manualReceiptForm">
                <div class="form-group">
                    <label for="amount">Amount (Nu.)</label>
                    <input type="number" 
                           id="amount" 
                           name="amount" 
                           step="1" 
                           min="0" 
                           required 
                           placeholder="Enter amount">
                </div>
                <div class="form-group">
                    <label for="particulars">Particulars</label>
                    <input type="text" 
                           id="particulars" 
                           name="particulars" 
                           required 
                           placeholder="Enter Particulars"
                           style="box-sizing: border-box;">
                </div>

                <button type="button" class="photo-option-btn" style="background: #000 !important; color: white !important;" onclick="handleManualSubmit()">
                    <span class="icon" style="color: white !important;">üíæ</span>
                    Submit
                </button>
                <button type="button" class="cancel-btn" onclick="closeManualEntryModal()">Cancel</button>
            </form>
        </div>
    </div>

</body>
</html>
